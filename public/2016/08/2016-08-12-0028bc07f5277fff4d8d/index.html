<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>
Dでつくるbrainfu*kのインタプリタ - Kotet&#39;s Personal Blog
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" media="screen" href="/main.css" /> <meta name="generator" content="Hugo 0.46" />
    
<meta name="description" content="brainf*ckの処理系はすでにいろんな人が作っているけど勉強になりそうだったので自分で書いてみた。">
<style>
    main {
        width: 800px;
        max-width: 100%;
        margin: 0 auto;
    }
    #TableOfContents > ul {  
        padding: 0;
    }
    #TableOfContents > ul > li > ul {  
        padding: 0;
    }
    #TableOfContents li {
        list-style: none;
    }
    #TableOfContents > ul > li > ul > li > ul li {
        list-style-type: initial;
    }
    aside {
        padding: .5em 1em;
        background: #EEE;
    }
</style>

</head>

<body>
    <header class="site">
        <h1><a href="/">Kotet&#39;s Personal Blog</a></h1>
        <nav>
            <ul>
                <li><a href="/about">ABOUT</a></li>
                <li><a href="/products">PRODUCTS</a></li>
                <li><a href="/tags">TAGS</a></li>
                
            </ul>
        </nav>
    </header>
    <main>
        
<h2>Dでつくるbrainfu*kのインタプリタ</h2>
<aside>
    <p>Table of Contents</p>
    
</aside>
<article><p>この記事はQiitaに投稿されたものの転載です。</p>

<hr />

<p>brainf*ckの処理系はすでにいろんな人が作っているけど勉強になりそうだったので自分で書いてみた。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-d" data-lang="d">import std.stdio;
import std.getopt;
import core.stdc.stdio;
import std.file;
import std.conv;

const BUFFSIZE = 30000;

void main(string[] args)
{
    string filename = args[1];
    string code = readText(filename);
    size_t ptr = 0;
    size_t codeptr = 0;
    ubyte[] memory = new ubyte[BUFFSIZE];
    while(codeptr &lt; code.length)
    {
        switch(code[codeptr])
        {
            case &#39;+&#39;:
                memory[ptr]++;
                break;
            case &#39;-&#39;:
                memory[ptr]--;
                break;
            case &#39;&gt;&#39;:
                ptr++;
                break;
            case &#39;&lt;&#39;:
                ptr--;
                break;
            case &#39;.&#39;:
                putchar(memory[ptr]);
                break;
            case &#39;,&#39;:
                int tmp = getchar();
                if(tmp == EOF) return;
                memory[ptr] = tmp.to!ubyte;
                break;
            case &#39;[&#39;:
                if(memory[ptr] == 0)
                {
                    int loopnest = 1;
                    do
                    {
                        codeptr++;
                        if(code[codeptr] == &#39;[&#39;) loopnest++;
                        if(code[codeptr] == &#39;]&#39;) loopnest--;
                    }while(0 &lt; loopnest);
                }
                break;
            case &#39;]&#39;:
                if(memory[ptr] != 0)
                {
                    int loopnest = 1;
                    do
                    {
                        codeptr--;
                        if(code[codeptr] == &#39;[&#39;) loopnest--;
                        if(code[codeptr] == &#39;]&#39;) loopnest++;
                    }while(0 &lt; loopnest);
                }
                break;
            default:
        }
        codeptr++;
    }
}</code></pre></div>
<p>getchar/putcharは何で置き換えればいいんだろうか？</p>

<p><a href="http://esoteric.sange.fi/brainfuck/utils/mandelbrot/">マンデルブロー集合を描かせて</a>時間計測。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ time ./kbfi mandelbrot.b
real	1m25.554s
user	1m25.464s
sys	0m0.044s

real	1m25.144s
user	1m25.104s
sys	0m0.004s

real	1m25.659s
user	1m25.640s
sys	0m0.000s

$ time bf mandelbrot.b
real	0m8.909s
user	0m8.888s
sys	0m0.012s

real	0m9.066s
user	0m9.048s
sys	0m0.004s

real	0m8.966s
user	0m8.952s
sys	0m0.008s</code></pre></div>
<p>遅いのでこれから速くしていきたい。</p>
</article>

        <div class="ad-wrapper"></div>
    </main>
    <footer class="site">
    <p>This site compiled at <time>2018-08-02T22:40:09&#43;0200</time></p>
</footer>
</body>

</html>